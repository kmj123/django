{% extends 'header_login.html'%}
{% load static %}
<!--ìƒë‹¨ í—¤ë”-->
{%block content%}

<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="csrf-token" content="{{ csrf_token}}">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/static/css/mypage.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <title>{%block title%}ë§ˆì´í˜ì´ì§€{%endblock%}</title>
    </head>
    <style>
    .modal{
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content{
            border-radius: 8px;
            width: 90%;
            max-width: 850px;
            background-color: #ffff;
            FONT-WEIGHT: 200;
            margin: 20px auto;
            padding: 20px;
        }

        .close {
        position: block;
        top: 10px;
        right: 16px;
        font-size: 28px;
        cursor: pointer;
        }
        /*ê²€ìƒ‰css*/

        .search-container {
        margin-bottom: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
        }

        .search-box {
        padding: 12px 20px;
        border: 2px solid #ddd;
        border-radius: 25px;
        font-size: 16px;
        width: 100%;
        transition: all 0.3s ease;
        }

        .search-box:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .filter-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        }

        .filter-btn {
        padding: 8px 16px;
        border: 2px solid #667eea;
        background: white;
        color: #667eea;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        }

        .filter-btn.active, .filter-btn:hover {
        background: #667eea;
        color: white;
        }

        .selected-count {
        text-align: center;
        margin-bottom: 20px;
        font-size: 18px;
        color: #333;
        font-weight: bold;
        }

        .selected-members {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        }

        .selected-members h3 {
        margin-bottom: 15px;
        color: #333;
        }

        .selected-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        }

        .selected-item {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding:15px;
        border-radius: 15px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
        }

        .remove-btn {
        background: rgba(255, 255, 255, 0.3);
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        cursor: pointer;
        color: white;
        font-size: 12px;
        }

        .search-noticeBox {
        text-align: center;
        padding: 40px 20px;
        background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
        border: 2px dashed #667eea;
        border-radius: 20px;
        margin: 20px 0;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .search-notice .icon {
        font-size: 48px;
        margin-bottom: 15px;
        display: block;
        }

        .search-notice .main-text {
        color: #667eea;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
        }

        .search-notice .sub-text {
        font-size: 14px;
        color: #999;
        }

        .groups-container {
            display: grid;
            gap: 20px;
            max-height: 400px;
            overflow-y: scroll;
        }

        .group-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .group-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .group-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
        }

        .group-name {
        font-size: 1.2em;
        font-weight: bold;
        color: #333;
        }

        .group-type {
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
        }

        .boy-group {
        background: #e3f2fd;
        color: #1976d2;
        }

        .girl-group {
        background: #fce4ec;
        color: #c2185b;
        }

        .members-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
        }

        .member-toggle {
        padding: 8px 12px;
        border: 2px solid #ddd;
        background: white;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 12px;
        font-weight: 500;
        }

        .member-toggle:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        }

        .member-toggle.selected {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-color: #667eea;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .member-toggle.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
        }

        .selection-limit-notice {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 10px 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        text-align: center;
        font-size: 14px;
        }
        .btn {
        width: 100%;
        padding: 1rem;
        border: none;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        }

        .btn-primary:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        }

    </style>

    <script>


        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
                }
            }
            }
            return cookieValue;
        }

        //ëª¨ë‹¬ì°½ ìŠ¤í¬ë¦½íŠ¸
        document.addEventListener('DOMContentLoaded', function () {
            const modalOpenButton = document.getElementById('profile_modal');
            const modalSaveButton = document.getElementById('favorite-btnSave');
            const modalCloseButton = document.getElementById('favorite-btnClose');
            const modal = document.getElementById('modalContainer');

            // ëª¨ë‹¬ì°½ ì˜¤í”ˆ
            modalOpenButton.addEventListener('click', () => {
                modal.classList.remove('hidden');
            });

            // ëª¨ë‹¬ì°½ ì €ì¥
            modalSaveButton.addEventListener('click', () => {
                modal.classList.add('hidden');
            });

            // ëª¨ë‹¬ì°½ ì·¨ì†Œ
            modalCloseButton.addEventListener('click',() => {
                modal.classList.add('hidden');
            });
            // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
            window.addEventListener('click', e => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
        });
        //ëª¨ë‹¬ì°½ìŠ¤í¬ë¦½íŠ¸

        // ì „ì²´ ì¹´í…Œê³ ë¦¬
        function showTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            const tabs = document.querySelectorAll('.tab');
            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            contents.forEach(content => {
                content.classList.remove('active');
            });

            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // ì„ íƒëœ íƒ­ ì½˜í…ì¸  ë³´ì´ê¸°
            document.getElementById(tabName).classList.add('active');

            // ì„ íƒëœ íƒ­ ë²„íŠ¼ í™œì„±í™”
            event.target.classList.add('active');
        }

        // êµí™˜ê±°ë˜ ì¹´í…Œê³ ë¦¬
        function showTransactionTab(type) {
            const transactionTabs = document.querySelectorAll('.transaction-tab');
            const transactionContents = document.querySelectorAll('.transaction-content');
            const sellingList = document.getElementById('selling-list');
            const buyingList = document.getElementById('buying-list');
            const tradingList = document.getElementById('trading-list');
            // êµí™˜ê±°ë˜ íƒ­ ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
            transactionTabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // êµí™˜ê±°ë˜ ì½˜í…ì¸ ë“¤ ìˆ¨ê¸°ê¸°
            transactionContents.forEach(content => {
                content.style.display = 'none';
            });

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            
            // ì„ íƒëœ ì½˜í…ì¸  ë³´ì´ê¸°
            if (type === 'selling') {
                sellingList.style.display = 'block';
            } else if(type==='buying'){
                buyingList.style.display = 'block';
            } else if(type==='trading'){
                tradingList.style.display='block';
            }
        }

        // í›„ê¸° ì¹´í…Œê³ ë¦¬
        function showReviewTab(type) {
            const reviewTabs = document.querySelectorAll('.review-tab');
            const reviewContents = document.querySelectorAll('.review-content');
            // í›„ê¸° íƒ­ ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
            reviewTabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // í›„ê¸° ì½˜í…ì¸ ë“¤ ìˆ¨ê¸°ê¸°
            reviewContents.forEach(content => {
                content.style.display = 'none';
            });

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            
            // ì„ íƒëœ ì½˜í…ì¸  ë³´ì´ê¸°
            if (type === 'received') {
                document.getElementById('received-reviews').style.display = 'block';
            } else {
                document.getElementById('written-reviews').style.display = 'block';
            }
        }

        // ì»¤ë®¤ë‹ˆí‹° ì¹´í…Œê³ ë¦¬ 
        function showCommunityTab(type){
            const communityTabs = document.querySelectorAll('.community-tab');
            const communityContents = document.querySelectorAll('.community-content');
            const WithU = document.getElementById('WithU');
            const Sharing = document.getElementById('Sharing');
            const Insteadbuy = document.getElementById('Insteadbuy');

            communityTabs.forEach(tab=>{
                tab.classList.remove('active');
            });

            communityContents.forEach(content=>{
                content.style.display="none";
            })

            event.target.classList.add('active');

            if (type === "WithU"){
                WithU.style.display="block";
            } else if(type === "Sharing"){
                Sharing.style.display="block";
            } else if(type === "Insteadbuy"){
                Insteadbuy.style.display="block";
            }
        }

        // ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì¹´í…Œê³ ë¦¬
        function showBlockedTab(type){
            const blockedTabs = document.querySelectorAll('.blocked-tab');
            const blockedContents = document.querySelectorAll('.blocked-content')
            const blockeduser = document.getElementById('blocked-user');
            const blockedpost = document.getElementById('blocked-post');

            // ë¸”ë™ë¦¬ìŠ¤íŠ¸ íƒ­ ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
            blockedTabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì½˜í…ì¸ ë“¤ ìˆ¨ê¸°ê¸°
            blockedContents.forEach(content => {
                content.style.display = 'none';
            });

            event.target.classList.add('active');

            // ì„ íƒëœ ì½˜í…ì¸  ë³´ì´ê¸°
            if (type === 'blocked-user') {
                blockeduser.style.display = 'block';
            } else {
                blockedpost.style.display = 'block';
            }
        }
        
        // ì•¨ë²” -> 
        function showPhotoCards(albumId) {
            const albumData = photocardData[albumId];
            if (!albumData) return;

            // ì•¨ë²” ëª©ë¡ ìˆ¨ê¸°ê¸°
            document.getElementById('album-list').style.display = 'none';
            
            // í¬í† ì¹´ë“œ ëª©ë¡ ë³´ì´ê¸°
            document.getElementById('photocard-list').style.display = 'block';
            
            // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ë³´ì´ê¸°
            document.querySelector('.back-btn').style.display = 'inline-block';
            
            // í˜„ì¬ ì•¨ë²” ì œëª© ì„¤ì •
            document.getElementById('current-album-title').textContent = albumData.title;
            
            // í¬í† ì¹´ë“œ ê·¸ë¦¬ë“œ ìƒì„±
            const photocardGrid = document.querySelector('.photocard-grid');
            photocardGrid.innerHTML = '';
            
            albumData.cards.forEach(card => {
                const photocardElement = document.createElement('div');
                photocardElement.className = 'photocard';
                photocardElement.innerHTML = `
                    <div class="photocard-img">
                        <img src="${card.img}" alt="${card.member}">
                    </div>
                    <h5>${card.member}</h5>
                    <p>${card.type}</p>
                    `;
                photocardGrid.appendChild(photocardElement);
            });
        }

        function showAlbumList() {
            // í¬í† ì¹´ë“œ ëª©ë¡ ìˆ¨ê¸°ê¸°
            document.getElementById('photocard-list').style.display = 'none';
            
            // ì•¨ë²” ëª©ë¡ ë³´ì´ê¸°
            document.getElementById('album-list').style.display = 'grid';
            
            // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            document.querySelector('.back-btn').style.display = 'none';
        }

        // ë³€ê²½í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.change-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                alert('ë³€ê²½ ê¸°ëŠ¥ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.');
            });
        });

        // ì°¨ë‹¨í•´ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.unblock-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if(confirm('ì •ë§ ì°¨ë‹¨ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.parentElement.remove();
                }
            });
        });

    </script>

    <body>
    <!--í”„ë¡œí•„-->
    <main class="main">
        <form>
            <div class="profile-card">
                <div class="profile-header">
                    <div class="polaroid" id="profile_modal">
                        <div class="polaroid-image">
                            <!--í´ë¦­ì‹œ í”„ë¡œí•„ë³€ê²½í˜ì´ì§€ ì´ë™-->
                            <img src='/media/{{profile_image}}/' alt='{{profile_image}}'>
                        </div>
                        
                        <!-- í”„ë¡œí•„ ìˆ˜ì • ëª¨ë‹¬ì°½ ì˜¤í”ˆ -->
                        <button id="favorite-btn" type="button">
                            {% for group in groups %}
                                <img src="/media/{{ group.image.url }}/" alt="{{ group.name }}">
                            {% endfor %}
                        </button>
                    </div>
                    <div class="profile-info">
                        <h1>{{nickname}}</h1>
                        <h3>"{{introduction}}"</h3>
                        <br>
                        
                        <div class="stats">
                            <div class="stat">
                                <div class="stat-number">{{selling_photocards}}</div>
                                <div>ë³´ìœ  í¬ì¹´</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">{{completed}}</div>
                                <div>êµí™˜ ì™„ë£Œ</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number">{{manners_score}}</div>
                                <div>í‰ì </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!--//í”„ë¡œí•„-->


        <div class="content">
            <div class="tabs-wrapper">
                <div class="tabs">
                    <button class="tab active " onclick="showTab('keywords')">í‚¤ì›Œë“œ</button>
                    <button class="tab" onclick="showTab('recent')">ìµœê·¼ë³¸ê¸€</button>
                    <button class="tab" onclick="showTab('mypoca')">ë§ˆì´ í¬ì¹´</button>
                    <button class="tab" onclick="showTab('wishlist')" >ìœ„ì‹œë¦¬ìŠ¤íŠ¸</button>
                    <button class="tab" onclick="showTab('transactions')">í¬í† ì¹´ë“œ</button>
                    <button class="tab" onclick="showTab('reviews')">í›„ê¸°ê¸€</button>
                    <button class="tab" onclick="showTab('community')">ì»¤ë®¤ë‹ˆí‹° ì‘ì„±ê¸€</button>
                    <button class="tab" onclick="showTab('blocked')">ë¸”ë™ë¦¬ìŠ¤íŠ¸</button>
                </div>
            </div>
            <!--í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸-->
            <div id="keywords" class="tab-content active">
                <div class="section-content">
                    <div class="item">
                        <h3>ê´€ì‹¬ ê·¸ë£¹ í‚¤ì›Œë“œ</h3>
                        <p>
                            {%for group in groups%}
                                #{{group.name}}
                            {%endfor%}
                        </p>
                    </div>
                    <div class="item">
                        <h3>ê´€ì‹¬ ë©¤ë²„ í‚¤ì›Œë“œ</h3>
                        <p>
                            {%for member in members%}
                                #{{member.name}}
                            {%endfor%}
                        </p>
                    </div>
                </div>
            </div>

            <!--ìµœì‹ ë³¸ê¸€-->
            <div id="recent" class="tab-content">
                <div class="section-content"></div>
            </div>

            <!--ë§ˆì´í¬ì¹´-->
            <div id="mypoca" class="tab-content">
                <div class="cards-header">
                    <button class="back-btn" onclick="showAlbumList()" style="display: none;">â† ì•¨ë²” ëª©ë¡ìœ¼ë¡œ</button>
                </div>
                
                <!-- ì•¨ë²” ëª©ë¡ ë·° -->
                <div class="section-content">
                    <div id="album-list" class="album-grid"></div>
                </div>

                
                <!-- í¬í† ì¹´ë“œ ëª©ë¡ ë·° (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
                <div id="photocard-list" style="display: none;">
                    <div id="current-album-title" class="current-album"></div>
                    <div class="section-content">
                        <div class="photocard-grid"></div>
                    </div>
                </div>
            </div>

            <!--ìœ„ì‹œë¦¬ìŠ¤íŠ¸-->
            <div id="wishlist" class="tab-content">
                <div class="section-content"></div>
            </div>

            <div id="transactions" class="tab-content">
                <div class="section-header">
                    <div class="transaction-tabs">
                        <button class="transaction-tab active" onclick="showTransactionTab('selling')">íŒë§¤ëª©ë¡</button>
                        <button class="transaction-tab" onclick="showTransactionTab('buying')">êµ¬ë§¤ëª©ë¡</button>
                        <button class="transaction-tab" onclick="showTransactionTab('trading')">êµí™˜ëª©ë¡</button>
                    </div>
                </div>
                
                <div class="section-content">
                    <!--íŒë§¤ëª©ë¡-->
                    <div id="selling-list" class="transaction-content"></div>
                    <!--êµ¬ë§¤ëª©ë¡-->
                    <div id="buying-list" class="transaction-content" style="display: none;"></div>
                    <!--êµí™˜ëª©ë¡-->
                    <div id="trading-list" class="transaction-content" style="display: none;"></div>
                </div>
            </div>

            <div id="reviews" class="tab-content">
                <div class="section-header">
                    <div class="review-tabs">
                        <button class="review-tab active" onclick="showReviewTab('received')">ë‚´ê°€ ë°›ì€ í›„ê¸°</button>
                        <button class="review-tab" onclick="showReviewTab('written')">ë‚´ê°€ ì“´ í›„ê¸°</button>
                    </div>
                </div>
                
                <!--ë‚´ê°€ ë°›ì€ ê±°ë˜ í›„ê¸°-->
                <div class="section-content">
                    <div id="received-reviews" class="review-content">
                        <div class="item review-item">
                            <h3>ì¹œì ˆí•˜ê³  ë¹ ë¥¸ ê±°ë˜<span class="rating">â­â­â­â­â­</span></h3>
                            <p>í¬ì¹´ ìƒíƒœë„ ì¢‹ê³  í¬ì¥ë„ ê¼¼ê¼¼íˆ í•´ì£¼ì…”ì„œ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤! - í¬ì¹´ë§¤ë‹ˆì•„ë‹˜</p>
                        </div>
                        <div class="item review-item">
                            <h3>ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê±°ë˜<span class="rating">â­â­â­â­â­</span></h3>
                            <p>ì„¤ëª…ê³¼ ë™ì¼í•œ ìƒíƒœì˜ í¬ì¹´ë¥¼ ë°›ì•˜ì–´ìš”. ì¶”ì²œí•©ë‹ˆë‹¤! - ì¹´ë“œìˆ˜ì§‘ëŸ¬ë‹˜</p>
                        </div>
                        <div class="item review-item">
                            <h3>ì¢‹ì€ ê±°ë˜ì˜€ìŠµë‹ˆë‹¤<span class="rating">â­â­â­â­</span></h3>
                            <p>ì†Œí†µì´ ì›í™œí•˜ê³  ì•½ì† ì‹œê°„ë„ ì˜ ì§€ì¼œì£¼ì…¨ì–´ìš”. - í¬ì¹´ëŸ¬ë‹˜</p>
                        </div>
                        <div class="view-all-container">
                        </div>
                    </div>
                </div>

                <!--ë‚´ê°€ ì“´ í›„ê¸°-->
                <div class="section-content">
                    <div id="written-reviews" class="review-content" style="display: none;">
                        <div class="item review-item">
                            <h3>ì™„ë²½í•œ ê±°ë˜ì˜€ì–´ìš”<span class="rating">â­â­â­â­â­</span></h3>
                            <p>í¬ì¹´ë§¤ë‹ˆì•„ë‹˜ê³¼ì˜ ê±°ë˜ - í¬ì¥ ìƒíƒœ ì™„ë²½í•˜ê³  ì†Œí†µë„ ì¢‹ì•˜ìŠµë‹ˆë‹¤!</p>
                        </div>
                        <div class="item review-item">
                            <h3>ë¯¿ê³  ê±°ë˜í•  ìˆ˜ ìˆëŠ” ë¶„<span class="rating">â­â­â­â­â­</span></h3>
                            <p>ì¹´ë“œìˆ˜ì§‘ëŸ¬ë‹˜ê³¼ì˜ ê±°ë˜ - ì‹œê°„ ì•½ì† ì˜ ì§€í‚¤ì‹œê³  ì¹œì ˆí•˜ì„¸ìš”</p>
                        </div>
                        <div class="item review-item">
                            <h3>ë§Œì¡±ìŠ¤ëŸ¬ìš´ ê±°ë˜<span class="rating">â­â­â­â­</span></h3>
                            <p>í¬ì¹´ëŸ¬ë‹˜ê³¼ì˜ ê±°ë˜ - ì„¤ëª… ê·¸ëŒ€ë¡œì˜ ìƒíƒœë¡œ ì˜ ë°›ì•˜ìŠµë‹ˆë‹¤</p>
                        </div>
                        <div class="item review-item">
                            <h3>ë§Œì¡±ìŠ¤ëŸ¬ìš´ ê±°ë˜<span class="rating">â­â­â­â­</span></h3>
                            <p>í¬ì¹´ëŸ¬ë‹˜ê³¼ì˜ ê±°ë˜ - ì„¤ëª… ê·¸ëŒ€ë¡œì˜ ìƒíƒœë¡œ ì˜ ë°›ì•˜ìŠµë‹ˆë‹¤</p>
                        </div>
                        <div class="item review-item">
                            <h3>ë§Œì¡±ìŠ¤ëŸ¬ìš´ ê±°ë˜<span class="rating">â­â­â­â­</span></h3>
                            <p>í¬ì¹´ëŸ¬ë‹˜ê³¼ì˜ ê±°ë˜ - ì„¤ëª… ê·¸ëŒ€ë¡œì˜ ìƒíƒœë¡œ ì˜ ë°›ì•˜ìŠµë‹ˆë‹¤</p>
                        </div>
                        <div class="view-all-container">
                        </div>
                    </div>
                </div>
            </div>

            <div id="community" class="tab-content">
                <div class="section-header">
                    <div class="community-tabs">
                        <button class="community-tab active" onclick="showCommunityTab('WithU')">ë™í–‰</button>
                        <button class="community-tab " onclick="showCommunityTab('Sharing')">ë‚˜ëˆ”</button>
                        <button class="community-tab " onclick="showCommunityTab('Insteadbuy')">ëŒ€ë¦¬êµ¬ë§¤</button>
                    </div>
                </div>

                <!--ë™í–‰ê¸€-->
                <div class="section-content">
                    <div id="WithU" class="community-content">
                        <div class="item">
                            <h3>BTS ë™í–‰</h3>
                            <p>2024.01.20 - ì¡°íšŒìˆ˜: 234 | ëŒ“ê¸€: 12</p>
                        </div>
                        <div class="item">
                            <h3>BTS ë™í–‰</h3>
                            <p>2024.01.18 - ì¡°íšŒìˆ˜: 456 | ëŒ“ê¸€: 28</p>
                        </div>
                        <div class="item">
                            <h3>BTS ë™í–‰</h3>
                            <p>2024.01.15 - ì¡°íšŒìˆ˜: 123 | ëŒ“ê¸€: 8</p>
                        </div>
                    </div> 
                </div>
                <!--ë‚˜ëˆ”ê¸€-->
                <div class="section-content">
                    <div id="Sharing" class="community-content" style="display: none;">
                        <div class="item">
                            <h3>í¬í† ì¹´ë“œ ë‚˜ëˆ”</h3>
                            <p>2024.01.20 - ì¡°íšŒìˆ˜: 234 | ëŒ“ê¸€: 12</p>
                        </div>
                        <div class="item">
                            <h3>í¬í† ì¹´ë“œ ë‚˜ëˆ”</h3>
                            <p>2024.01.18 - ì¡°íšŒìˆ˜: 456 | ëŒ“ê¸€: 28</p>
                        </div>
                        <div class="item">
                            <h3>í¬í† ì¹´ë“œ ë‚˜ëˆ”</h3>
                            <p>2024.01.15 - ì¡°íšŒìˆ˜: 123 | ëŒ“ê¸€: 8</p>
                        </div>
                    </div> 
                </div>
                <!--ëŒ€ë¦¬êµ¬ë§¤-->
                <div class="section-content">
                    <div id="Insteadbuy" class="community-content" style="display: none;">
                        <div class="item">
                            <h3>ì•¨ë²” ëŒ€ë¦¬êµ¬ë§¤</h3>
                            <p>2024.01.20 - ì¡°íšŒìˆ˜: 234 | ëŒ“ê¸€: 12</p>
                        </div>
                        <div class="item">
                            <h3>ì•¨ë²” ëŒ€ë¦¬êµ¬ë§¤</h3>
                            <p>2024.01.18 - ì¡°íšŒìˆ˜: 456 | ëŒ“ê¸€: 28</p>
                        </div>
                        <div class="item">
                            <h3>ì•¨ë²” ëŒ€ë¦¬êµ¬ë§¤</h3>
                            <p>2024.01.15 - ì¡°íšŒìˆ˜: 123 | ëŒ“ê¸€: 8</p>
                        </div>
                    </div> 
                </div>
            </div>

            <!--ë¸”ë™ë¦¬ìŠ¤íŠ¸-->
            <div id="blocked" class="tab-content">
                <div class="section-header">
                    <div class="blocked-tabs">
                        <button class="blocked-tab active" onclick="showBlockedTab('blocked-user')">ë‚´ê°€ ì°¨ë‹¨í•œ ì‚¬ìš©ì</button>
                        <button class="blocked-tab" onclick="showBlockedTab('blocked-post')">ë‚´ê°€ ì‹ ê³ í•œ ê¸€</button>
                    </div>
                </div>

                <div class="section-content">
                    <div id="blocked-user" class="blocked-content"> </div>
                </div>

                <div class="section-content">
                    <div id="blocked-post" class="blocked-content" style="display: none;">
                        <div class="item">
                            <h3>ë§¤ìš°ë§¤ìš° ì•ˆì¢‹ì€ ê¸€</h3>
                            <button class="unblock-btn">ì°¨ë‹¨í•´ì œ</button>
                            <p>ì°¨ë‹¨ ì‚¬ìœ : ë§¤ìš°ë§¤ìš° ì•ˆì¢‹ì€ ê¸€</p>
                        </div>
                        <div class="item">
                            <h3>ì‚¬ê¸°ê¾¼ì˜ ê¸€</h3>
                            <button class="unblock-btn">ì°¨ë‹¨í•´ì œ</button>
                            <p>ì°¨ë‹¨ ì‚¬ìœ : ì‚¬ê¸°ê¾¼ì˜ ê¸€</p>
                        </div>
                    </div>
                </div>
            </div>
            <!--//ë¸”ë™ë¦¬ìŠ¤íŠ¸-->
        </div>
    </main>
    
        <!--í”„ë¡œí•„ ìˆ˜ì • ëª¨ë‹¬ì°½ êµ¬í˜„-->
        <form action="/mypage/update_profile/" method="post" name="profileFrm" enctype="multipart/form-data">
            {% csrf_token %}
            <div id="modalContainer" class="hidden">
                <div id="modalContent">
                    <div class="profileTop">
                        <button id="favorite-btnClose" type="button">
                            <img src="/static/images/mypage/cancelicon.png" style="width: 40px; height: 40px;">
                        </button>
                        <h1>í”„ë¡œí•„ ìˆ˜ì •</h1>
                    </div>
                    <div class="profileContent">
                        <label for="profile_image">í”„ë¡œí•„ ì´ë¯¸ì§€</label>
                        <div class="profile_img_container">
                            <div class="profile_img_wrapper">
                                <div class="previous_container" id="previous_container" style="cursor:pointer;">
                                    <img id="previousImage" src="/media/{{ profile_image }}/" class="profile_image" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
                                </div>
                                <input type="file" id="profile-img-input" name="profile_image" class="fileType" accept="image/*" style="display:none;">
                            </div>
                            <div class="preview-container" id="previewContainer" style="display:none;">
                                <img id="previewImage" class="preview-image" alt="ë¯¸ë¦¬ë³´ê¸°">
                            </div>
                        </div>
                        <div class="myinfo">
                            <div class="myinfo-profile">
                                <label for="nickname">ë‹‰ë„¤ì„</label>
                                <input type="text" id="nickname" name="nickname" value="{{ nickname }}">
                            </div>
                            <div class="myinfo-profile">
                                <label for="mybias">ìµœì• ë³€ê²½</label>
                                {% for group,member in bias_pairs %}
                                <div class="mybias_input">
                                        <input type="text" id="mybias" name="mybias" value="{{ group.name }} - {{member.name}}" readonly style="cursor: pointer;">
                                </div>
                                    {% endfor %}
                            </div>
                                    <!--ì•„í‹°ìŠ¤íŠ¸ ê²€ìƒ‰ ëª¨ë‹¬ì°½-->
                                    <div id="searchModal" class="modal" >
                                        <div class="modal-content">
                                            <span id="searchModalOpenClose" class="close">&times;</span>
                                            <form id="memberSearchForm" method="POST" action="{% url 'signup:member_select' %}">
                                                {% csrf_token %}
                                                <div class="search-container">
                                                    <input type="text" class="search-box" placeholder="ê·¸ë£¹ëª… ë˜ëŠ” ë©¤ë²„ëª…ìœ¼ë¡œ ê²€ìƒ‰..." id="idolSearch">
                                                    <input type="hidden" name="group_name" id="selectedGroup">
                                                    <input type="hidden" name="member_name" id="selectedMember">

                                                    <div class="filter-buttons">
                                                        <button type="button" class="filter-btn" data-filter="all">ì „ì²´</button>
                                                        <button type="button" class="filter-btn" data-filter="boy">ë³´ì´ê·¸ë£¹</button>
                                                        <button type="button" class="filter-btn" data-filter="girl">ê±¸ê·¸ë£¹</button>
                                                    </div>
                                                </div>

                                                <div class="selected-members" id="selectedMembers" style="display: none;">
                                                    <h3>ğŸŒŸ ì„ íƒëœ ë©¤ë²„</h3>
                                                    <div class="selected-list" id="selectedList"></div>
                                                </div>

                                                <div class="search-noticeBox" id="searchNotice">
                                                    <span class="icon">ğŸ”</span>
                                                    <div class="main-text">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì•„ì´ëŒ ê·¸ë£¹ì„ ì°¾ì•„ë³´ì„¸ìš”!</div>
                                                    <div class="sub-text">ê·¸ë£¹ëª… ë˜ëŠ” ë©¤ë²„ëª…ìœ¼ë¡œ ê²€ìƒ‰ ê°€ëŠ¥í•©ë‹ˆë‹¤</div>
                                                </div>
                                                
                                                <div class="groups-container" id="groupsContainer"></div>
                                                <div id="hiddenInputsContainer"></div>
                                                <button id="completeBtn" class="btn btn-primary" type="button" disabled>ì™„ë£Œ</button>
                                            </form>
                                        </div>
                                    </div>
                            
                            <div class="myinfo-profile">
                                <label for="myself">ìê¸°ì†Œê°œ</label>
                                <input type="text" id="myself" name="myself" value="{{ introduction}}">
                            </div>
                            <div class="myinfo-profile">
                                <button id="favorite-btnSave" type="submit">ë³€ê²½ì‚¬í•­ ì €ì¥</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>


    <script>
        // íŒŒì¼ì—…ë¡œë“œ ê´€ë ¨
        const imageuploadContainer = document.getElementById('previous_container');
        const imageInput = document.getElementById('profile-img-input');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const previousImage = document.getElementById('previousImage');

        imageuploadContainer.addEventListener('click',()=>imageInput.click());

        imageuploadContainer.addEventListener('dragover',(e)=>{
            e.preventDefault();
            imageuploadContainer.classList.add('dragover');
        });

        imageuploadContainer.addEventListener('dragleave',(e)=>{
            e.preventDefault();
            imageuploadContainer.classList.remove('dragover');
        });

        imageuploadContainer.addEventListener('drop',(e)=>{
            e.preventDefault();
            imageuploadContainer.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if(files.length > 0 ){
                handleFile(files[0]);
            }
        });

        imageInput.addEventListener('change',(e)=>{
            if(e.target.files.length>0){
                handleFile(e.target.files[0]);
            }
        });

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜
        function handleFile(file) {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImage.src = e.target.result;
                    previewContainer.style.display = "block";
                    previousImage.style.display = "none"; // ê¸°ì¡´ ì´ë¯¸ì§€ ìˆ¨ê¹€
                };
                reader.readAsDataURL(file);
            } else {
                alert("ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            }
        }

        // #Recent AJAX
        $.ajax({
            url: "/mypage/latest/",
            type: "POST",
            headers: { "X-CSRFToken": $('meta[name="csrf-token"]').attr('content') },
            success: function (data) {
                console.log('ìµœê·¼ ê²Œì‹œê¸€ ì—°ê²° ì„±ê³µ')

                const recentList = $("#recent .section-content");

                const cardsHtml = data.photocards.map(card => 
                `<div class="item">
                    <div>
                        <h3>${card.title}</h3>
                        <p>${card.created_at} - ${card.album}</p>
                    </div>  
                </div>`).join("");

                recentList.html(cardsHtml || "<div class='error-content'>ìµœê·¼ ë³¸ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>");
            },
            error: function () {
                console.error("ìµœê·¼ ë³¸ ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                recentList.html("<div class='error-content'>ìµœê·¼ ë³¸ ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>");
            }
        });

        // #mypoca AJAX
        $.ajax({
            url: "/mypage/mypoca/",
            type: "POST",
            headers: { "X-CSRFToken": $('meta[name="csrf-token"]').attr('content') },
            dataType: "json",
            success: function (data) {
                console.log("ë°›ì€ ë°ì´í„°:", data.group_album_dict);

                const albumList = $("#mypoca #album-list");
                albumList.empty(); // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸°

                const groupAlbumDict = data.group_album_dict;

                for (let groupName in groupAlbumDict) {
                    const albumMap = groupAlbumDict[groupName];

                    for (let albumName in albumMap) {
                        const photocards = albumMap[albumName];
                        const firstCard = photocards[0]; // ëŒ€í‘œ ì´ë¯¸ì§€
                        const imageUrl = firstCard.image_url || '{/static/images/default.jpg}';
                        const cardCount = photocards.length;

                        const albumCard = `
                            <div class="album-card" onclick="showPhotoCards('${groupName}-${albumName}')">
                                <div class="album-cover">
                                    <img src="${imageUrl}" alt="${albumName}">
                                </div>
                                <div class="album-info">
                                    <h4>${albumName}</h4>
                                    <p>${groupName}</p>
                                    <span class="card-count">${cardCount}ì¥</span>
                                </div>
                            </div>
                        `;
                        albumList.append(albumCard);  

                        albumList.append(albumList || "<div class='error-content'>ë³´ìœ í•œ í¬í† ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>");
                    }
                }            
            },
            error: function (xhr, status, error) {
                console.error("ë§ˆì´í¬ì¹´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                albumList.html("<div class='error-content'>ë³´ìœ í•œ í¬í† ì¹´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>");
            }
        });

        // #wishlist AJAX
        $.ajax({
            url: "/mypage/wishlist/",
            type: "POST",
            headers: { "X-CSRFToken": $('meta[name="csrf-token"]').attr('content') },
            dataType: 'json',
            success: function(data){
                console.log('ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì—°ê²° ì„±ê³µ',data.wishlist);
                // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸°
                const wishList = $("#wishlist .section-content");
                wishList.empty();

                const wishdata = data.wishlist.map(wish => 
                    `<a href="/photocard/view/">
                        <div class="item">
                            <div class="wishlist">
                                <div class="wish-list-img">
                                    <img src=${wish.image_url}>
                                </div>
                                <div class="wish-list-txt">
                                    <span class="badge complete">${wish.trade_state}</span>
                                    <h3>${wish.title}
                                    </h3>
                                    <p>${wish.album}</p>
                                </div>
                            </div>
                        </div>
                    </a>`).join("");
                wishList.append(wishdata || "<div class='error-content'>ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>")
            },
            error: function (xhr, status, error) {
                console.error("ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                wishList.html("<div class='error-content'>ìœ„ì‹œë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>");
            }
        });

        // íŒë§¤ ëª©ë¡ AJAX
        $.ajax({
            url: "/mypage/trade/",
            type: "POST",
            headers: { "X-CSRFToken": $('meta[name="csrf-token"]').attr('content') },
            dataType: "json",
            success: function(data){
                console.log('íŒë§¤ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ');

                const saleList = $("#transactions #selling-list");
                saleList.empty();

                const saleData = data.sell_poca.map(sell => 
                    `<div class="item">
                        <h3>${sell.title}</h3>
                        <p>${sell.album} | ìƒíƒœ: ê±°ë˜${sell.trade_state}</p>
                    </div>`).join("");

                saleList.append(saleData||"<div class='error-content'>íŒë§¤ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>");
            }, error: function(xhr, status, error){
                console.error("íŒë§¤ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                saleList.html("<div class='error-content'>íŒë§¤ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>");
            }
        });
        // êµ¬ë§¤ ëª©ë¡ AJAX
        $.ajax({
            url: "/mypage/trade/",
            type: "POST",
            headers: { "X-CSRFToken": $('meta[name="csrf-token"]').attr('content') },
            dataType: "json",
            success: function(data){
                console.log('êµ¬ë§¤ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ');

                const buyList = $("#transactions #buying-list");
                buyList.empty();

                const buyData = data.buy_poca.map(buy => 
                    `<div class="item">
                        <h3>${buy.title}</h3>
                        <p>${buy.album} | ìƒíƒœ: ê±°ë˜${buy.trade_state}</p>
                    </div>`).join("");
                    buyList.append(buyData||"<div class='error-content'>íŒë§¤ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>");

            }, error: function(xhr, status, error){
                console.error("íŒë§¤ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                buyList.html("<div class='error-content'>íŒë§¤ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>");
            }
        });
        // êµí™˜ ëª©ë¡ AJAX => ì‹¤ì œ êµí™˜ëª©ë¡ ë¦¬ìŠ¤íŠ¸ë¡œ ìˆ˜ì • í•„ìš”
        $.ajax({
            url: "/mypage/trade/",
            type: "POST",
            headers: { "X-CSRFToken": $('meta[name="csrf-token"]').attr('content') },
            dataType: "json",
            success: function(data){
                console.log('êµí™˜ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤');

                const saleList = $("#transactions #trading-list");
                saleList.empty();

                const saleData = data.sell_poca.map(sell => 
                    `<div class="item">
                        <h3>${sell.title}</h3>
                        <p>${sell.album} | ìƒíƒœ: ê±°ë˜${sell.trade_state}</p>
                    </div>`);

                saleList.append(saleData||"<div class='error-content'>íŒë§¤ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>");
            }, error: function(xhr, status, error){
                console.error("íŒë§¤ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                saleList.html("<div class='error-content'>íŒë§¤ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>");
            }
        });
        
        // ë‚´ê°€ ì“´ í›„ê¸°ê¸€

        // ë‚´ê°€ ë°›ì€ í›„ê¸°ê¸€

        // ì»¤ë®¤ë‹ˆí‹° - ë™í–‰ê¸€

        // ì»¤ë®¤ë‹ˆí‹° - ë‚˜ëˆ”ê¸€

        // ì»¤ë®¤ë‹ˆí‹° - ëŒ€ë¦¬êµ¬ë§¤

        // ë¸”ë™ë¦¬ìŠ¤íŠ¸ - ì°¨ë‹¨í•œ ì‚¬ìš©ì ëª©ë¡ AJAX
        $.ajax({
            url: "/mypage/blocklist/",
            type: "POST",
            headers: { "X-CSRFToken": $('meta[name="csrf-token"]').attr('content') },
            dataType: "json",
            success: function(data){
                console.log('ì°¨ë‹¨ ì‚¬ìš©ì ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ');

                const blocked_user = $("#blocked #blocked-user");
                blocked_user.empty();

                const blockData = data.blocked_users.map(user => 
                    `<div class="item">
                        <h3>${user.user_id}${user.name}</h3>
                        <button class="unblock-btn">ì°¨ë‹¨í•´ì œ</button>
                        <p>ì°¨ë‹¨ ì‚¬ìœ : ìŠ¤íŒ¸ ë©”ì‹œì§€ ë°˜ë³µ ë°œì†¡</p>
                    </div>`).join("");

                blocked_user.append(blockData||"<div class='error-content'>ì°¨ë‹¨ ì‚¬ìš©ì ì—†ìŠµë‹ˆë‹¤.</div>");
            }, error: function(xhr, status, error){
                console.error("ì°¨ë‹¨ ì‚¬ìš©ì ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                blocked_user.html("<div class='error-content'>ì°¨ë‹¨ ì‚¬ìš©ì ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>");
            }
        });
    
        $('#profileForm').on('submit', function(e) {
        e.preventDefault();

        const formData = new FormData(this);

        $.ajax({
            url: '/mypage/update_profile/',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            headers: {
            'X-CSRFToken': getCookie('csrftoken')  // CSRF í† í° í•„ìš”
            },
            success: function(response) {
                alert("í”„ë¡œí•„ ìˆ˜ì • ì„±ê³µ");
            },
            error: function(xhr) {
                alert('ì˜¤ë¥˜: ' + xhr.responseJSON?.message || 'ìš”ì²­ ì‹¤íŒ¨');
            }
        });
        });
s




        // ì•„í‹°ìŠ¤íŠ¸ ê²€ìƒ‰ ëª¨ë‹¬ì°½
    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById('searchModal');
        const searchModalOpen = document.getElementById('searchModalOpen');
        const searchModalClose = document.getElementById('searchModalOpenClose');
        const searchInput = document.getElementById('idolSearch');
        const completeBtn = document.getElementById('completeBtn');
        const groupsContainer = document.getElementById('groupsContainer');
        const searchNotice = document.getElementById('searchNotice');
        const hiddenInputsContainer = document.getElementById('hiddenInputsContainer');
        const memberGrid = document.querySelector('.mybias_input');
        
        const mybiasInput = document.getElementById("mybias");
        mybiasInput.addEventListener("click", () => {
            searchModal.style.display = "block";

            // ê²€ìƒ‰ ì´ˆê¸°í™”
            searchInput.value = '';
            searchInput.focus();
            groupsContainer.innerHTML = '';
            searchNotice.style.display = 'block';
            selectedMember = null;
            completeBtn.disabled = true;

            // ì „ì²´ ë¡œë”©
            fetch(`/idols/search/?q=`)
                .then(res => res.json())
                .then(data => {
                    allData = data.members;
                    renderGroups();
                });
        });  
        
        // ëª¨ë‹¬ ë‹«ê¸°
        searchModalClose.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', e => {
            if (e.target === modal) modal.style.display = 'none';
        });


        // ê²€ìƒ‰ ì²˜ë¦¬
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim();
            if (!query) {
                groupsContainer.innerHTML = '';
                searchNotice.style.display = 'block';
                return;
            }

            // api query
            fetch(`/idols/search/?q=${query}`)
                .then(res => res.json())
                .then(data => {
                    groupsContainer.innerHTML = '';
                    searchNotice.style.display = 'none';
                    completeBtn.disabled = true;

                    // ê²€ìƒ‰ëœ ê²°ê³¼ê°€ 1ëª…ì¼ ê²½ìš°
                    if (data.members.length === 1) {
                        const member = data.members[0];
                        selectedMember = {
                            group: member.group__name,
                            member: member.name
                        };
                        renderSingleResult(member);
                        completeBtn.disabled = false;
                        return;
                    }

                    // ê²€ìƒ‰ëœ ê²°ê³¼ê°€ ì—¬ëŸ¬ëª… ê²½ìš°
                    const groups = {};
                    data.members.forEach(m => {
                        const group = m.group__name;
                        if (!groups[group]) {
                            groups[group] = { gender: m.group__gender, members: [] };
                        }
                        groups[group].members.push(m);
                    });

                    Object.entries(groups).forEach(([groupName, info]) => {
                        const groupCard = document.createElement('div');
                        groupCard.className = 'group-card';
                        const typeClass = info.gender === "M" ? "boy-group" : "girl-group";

                        groupCard.innerHTML = `
                            <div class="group-header">
                                <div class="group-name">${groupName}</div>
                                <div class="group-type ${typeClass}">
                                    ${info.gender === "M" ? "ë³´ì´ê·¸ë£¹" : "ê±¸ê·¸ë£¹"}
                                </div>
                            </div>
                            <div class="members-grid">
                                ${info.members.map(member => {
                                    const isSelected = selectedMember && selectedMember.group === groupName && selectedMember.member === member.name;
                                    return `
                                        <button type="button" class="member-toggle ${isSelected ? 'selected' : ''}"
                                            data-group="${groupName}" data-member="${member.name}">
                                            ${member.name}
                                        </button>
                                    `;
                                }).join('')}
                            </div>
                        `;
                        groupsContainer.appendChild(groupCard);
                    });
                });
        });

        // ë‹¨ì¼ ê²°ê³¼ ë Œë”ë§
        function renderSingleResult(member) {
            groupsContainer.innerHTML = `
                <div class="group-card">
                    <div class="group-header">
                        <div class="group-name">${member.group__name}</div>
                        <div class="group-type ${member.group__gender === "M" ? "boy-group" : "girl-group"}">
                            ${member.group__gender === "M" ? "ë³´ì´ê·¸ë£¹" : "ê±¸ê·¸ë£¹"}
                        </div>
                    </div>
                    <div class="members-grid">
                        <button type="button" class="member-toggle selected"
                            data-group="${member.group__name}" data-member="${member.name}">
                            ${member.name}
                        </button>
                    </div>
                </div>
            `;
        }

        // ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ ë©¤ë²„ ì„ íƒ
        groupsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('member-toggle')) {
                const group = e.target.dataset.group;
                const member = e.target.dataset.member;

                selectedMember = { group, member };
                completeBtn.disabled = false;

                // ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 
                document.querySelectorAll('.member-toggle').forEach(btn => {
                    btn.classList.remove('selected');
                });
                e.target.classList.add('selected');
            }
        });

        // ì™„ë£Œ ë²„íŠ¼ í´ë¦­
        completeBtn.addEventListener('click', () => {
            if (!selectedMember) return;

            // hidden input ìƒì„±
            hiddenInputsContainer.innerHTML = `
                <input type="hidden" name="group" value="${selectedMember.group}">
                <input type="hidden" name="member" value="${selectedMember.member}">
            `;

            // ë©”ì¸ í˜ì´ì§€ì— ë Œë”ë§
            memberGrid.innerHTML = `
                    <input type="text" id="mybias" name="mybias" value="${selectedMember.group} - ${selectedMember.member}" readonly style="cursor: pointer;">
            `;

            modal.style.display = 'none';
        });

        // í•„í„° ë²„íŠ¼ ì²˜ë¦¬
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                searchInput.dispatchEvent(new Event('input'));
            });
        });

    });

    </script>

{%endblock%}
<!--//ìƒë‹¨í—¤ë”-->
</body>
</html>