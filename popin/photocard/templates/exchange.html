{% extends "header_login.html" %}
{% load static %}
{% block content %}
<title>{% block title %}í¬í† ì¹´ë“œ êµí™˜{% endblock %}</title>
<style>
    .fb{
        position:fixed;
        bottom:25px; right:310px;
        width:55px; height:55px;
        justify-content:center;
        background-color: white;
        border:1px solid white;
        padding:1rem;
        border-radius: 50%;
    }

    .fb a{
        color:#333;
        text-decoration: none;
        font-size:1.2rem;
    }

    .content{
        width:1200px;
        display:flex;
        margin:0 auto;
        box-sizing: border-box;
    }

    /* ê²€ìƒ‰ í•„í„° ì˜ì—­ */
    .sfilter{
        width:330px;
        height:835px;
        background: rgba(255, 255, 255, 0.95);
        margin: 20px 10px 20px 25px;
        padding:20px;
        border-radius: 20px;
        transition: all 0.3s ease;  /* í¬ê¸°ë‚˜ ìƒíƒœ ë³€í™” ì‹œ ë¶€ë“œëŸ½ê²Œ ì „í™˜ */
        display: block; /* ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì„ */
    }

    .sfilter h4{color:#666666;}

    .sfilter > div{padding-top:20px;}

    /* ê·¸ë£¹ ê²€ìƒ‰ */
    .groupsearch{
        display:flex; justify-content: space-between; gap:3px; width:100%; box-sizing: border-box; margin-bottom:10px;
    }

    #searchinput {width:100%; box-sizing:border-box;
        border:2px solid #ddd; background-color:white; color:#333; font-size:16px;
        padding:10px; border-radius: 5px; cursor:pointer; margin-top:10px;
    }

    .sfilter > .fchoice {padding:0 0 10px 0;}

    /* ë©¤ë²„ ì„ íƒ í† ê¸€ */
    .memberToggle{display:none;}
    
    .members {
        display:grid;
        grid-template-rows: repeat(3, 40px);
        grid-template-columns: repeat(2, 124px);
        gap:10px;
        margin-top:10px;
        max-height:190px;
        overflow-y: auto;
        max-width:280px;
        overflow-x: hidden;
        box-sizing: border-box;
    }
    .members label {
        font-size: 15px;
        color: #333;
        background-color: white;
        border: 2px solid #e4e4e4;
        border-radius: 5px;
        text-align: center;
        line-height: 35px;
        cursor:pointer;
        user-select: none;
        width:100%; height:100%;
        box-sizing: border-box;
    }
    .memberToggle:checked + label {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding-top:2px;
        box-sizing: border-box;
    }


    /* ë“œë¡­ë‹¤ìš´ */
    .dropdown{
        position: relative;
        display: inline-block;
        width:100%;
        margin-bottom:10px;
    }
    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 257px;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
        width:100%;
    }

    .last-dropdown .dropdown-content {
        max-height: 200px; /* ë“œë¡­ë‹¤ìš´ ìµœëŒ€ ë†’ì´ ì„¤ì • */
        overflow-y: auto;  /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
    }

    .dropdown-content .dropdown-item {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }
    .dropdown-content .dropdown-item:hover {
        background-color: #ddd;
    }

    .dropdown-text {
        background:#eee;
        cursor: pointer;
        border:2px solid #ddd;
        border-radius: 5px;
        padding:10px;
        margin-top:10px;
    }

    .clocation{
        display:flex;
        justify-content: space-between;
        align-items:center;
        border:2px solid #ddd;
        border-radius: 5px;
        margin-top:10px;
        padding:10px;
        user-select: none;
    }

    .clocation a{color:#333;}

    #searchBtn{
        width:258px; height:50px; width:100%;
        font-weight:600; font-size:18px;
        border: 2px solid #667eea;
        color: #667eea;
        background: transparent;
        border-radius:5px;
        cursor:pointer;
        margin-top:5px;
    }

    #searchBtn:hover {background: #667eea; color: white;}


    /* í¬í† ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
    .photocardList {
        width:870px;
        height:835px;
        background: rgba(255, 255, 255, 0.95);
        margin: 20px 25px 20px 10px;
        padding:20px;
        border-radius: 20px;
    }

    .photoGrid {
        display:grid;
        grid-template-rows: repeat(3, 245px);
        grid-template-columns: repeat(4, 183px);
        gap:10px;
        max-height:755px;
        overflow-y: auto;
        width:100%; height:100%;
        box-sizing: border-box;
        overflow-x: hidden;
    }

    .no-results {
        font-size: 1rem;
        color: #888;
        text-align: center;
        display: none;  /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¸°ê¸° */
    }

    .no-members {
        font-size: 1rem;
        color: #888;
        text-align: center;
        display: block;  /* ê¸°ë³¸ì ìœ¼ë¡œ ë©¤ë²„ ì„ íƒ ë©”ì‹œì§€ ë³´ì´ê¸° */
    }

    .cardItem {
        width: 183px;
        height: 245px;
        overflow: hidden;
    }

    .card-image {
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .card-image img:hover {
        transform: scale(1.05);
        transition: transform 0.3s ease;
    }


    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
        .nav {
            position: relative;
            width:100%;
        }
        
        .nav-menu, .user-info {
            display: none;
        }

        .mobile-menu-btn {
            display: block;
        }

        .mobile-sidebar-menu{
            display:none;   /* ê¸°ë³¸ì€ ë‹«í˜ */
        }

        .mobile-sidebar-menu.active {
            display:block;
        }

        .content{
            display:inline-block;
            width:90%;
        }

        .sfilter {
            width:100%;
            height: 65px;  /* ëª¨ë°”ì¼ì—ì„œëŠ” ì ‘íŒ ìƒíƒœë¡œ ë†’ì´ë¥¼ ì¤„ì„ */
            overflow: hidden;  /* ì ‘íŒ ë¶€ë¶„ì´ ì˜ë¦¬ë„ë¡ ì„¤ì • */
            cursor: pointer;  /* í´ë¦­ ì‹œ í¼ì³ì§€ë„ë¡ í¬ì¸í„° ì»¤ì„œ ì„¤ì • */
            box-sizing: border-box;
            margin-left:20px;
        }

        /* sfilterê°€ í¼ì³ì§ˆ ë•Œ */
        .sfilter.active {
            height: 835px;  /* í¼ì³ì¡Œì„ ë•Œ ì›ë˜ ë†’ì´ë¡œ ì„¤ì • */
            overflow: visible;  /* í¼ì³ì¡Œì„ ë•Œ ë‚´ìš©ì´ ë‹¤ ë³´ì´ë„ë¡ */
        }

        .members {
            display: grid;
            grid-template-columns: repeat(2, 48%);
            max-width: 100%;
        }

        .photocardList{width:100%; overflow:hidden; box-sizing: border-box; margin-left:20px;}

        .photoGrid {
            display:grid;
            grid-template-rows: repeat(3, 245px);
            grid-template-columns: 183px;
            gap:10px;
            justify-content: center;
            max-height:755px;
            overflow-y: auto;
            width:100%; height:100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        .fb {
            position:fixed;
            left:35px;
            bottom:35px;
        }
    }

    @media (max-width: 480px) {
        .header {
            padding: 1rem;
        }
        
        .logo {
            font-size: 1.5rem;
        }
    }

    @media (max-width: 320px) {
        .mobile-menu {
            width: 280px;
        }
    }
</style>
<script>
    $(document).ready(function() {
        // "ê²€ìƒ‰ í•„í„°" í…ìŠ¤íŠ¸ë¥¼ í´ë¦­í–ˆì„ ë•Œë§Œ í¼ì¹˜ê±°ë‚˜ ì ‘ê¸°
        $('.filter-label').click(function () {
            $(this).closest('.sfilter').toggleClass('active'); // sfilter ì „ì²´ì— active í´ë˜ìŠ¤ í† ê¸€
        });

        // ë“œë¡­ë‹¤ìš´ //
        $('.dropdown-text').click(function() {
            var dropdownContent = $(this).next('.dropdown-content');
            dropdownContent.toggle();
        });

        // ë©”ë‰´ í•­ëª© í´ë¦­ ì‹œ í…ìŠ¤íŠ¸ ë³€ê²½
        $('.dropdown-content .dropdown-item').click(function(e) {
            e.preventDefault();
            var selectedOption = $(this).data('option');
            $(this).closest('.dropdown').find('.dropdown-text').text(selectedOption);
            $(this).closest('.dropdown').find('.dropdown-content').hide();
        });

        // ë©”ë‰´ ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        $(document).click(function(e) {
            if (!$(e.target).closest('.dropdown').length) {
                $('.dropdown-content').hide();
            }
        });

        // ê·¸ë£¹ ê²€ìƒ‰
        const groupMembers = {
            {% for groupMember in list %}
                "{{groupMember.group.name}}":[{% for member in groupMember.group.members.all %}"{{member.name}}"{% if not forloop.last %},{% endif %}{% endfor %}],
                "{{groupMember.group.name_en}}":[{% for member in groupMember.group.members.all %}"{{member.name}}"{% if not forloop.last %},{% endif %}{% endfor %}]{% if not forloop.last %},{% endif %}
            {% endfor %}
        };
        console.log(groupMembers);

        // ê·¸ë£¹ ê²€ìƒ‰ ì…ë ¥ ì‹œ ë™ì‘
        $('#searchinput').on('input', function() {
            const searchText = $(this).val().toLowerCase();
            $('.members').empty(); // ë©¤ë²„ ëª©ë¡ ì´ˆê¸°í™”

            if (searchText) {
                $('.fchoice').show(); // ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ ë³´ì´ê¸°

                for (const group in groupMembers) {
                    if (group.toLowerCase().includes(searchText)) {
                        // í•´ë‹¹ ê·¸ë£¹ì— ì†í•œ ë©¤ë²„ë“¤ ì¶”ê°€
                        $('.members').append(`
                            <input type="checkbox" id="memberAll" class="memberToggle">
                            <label for="memberAll">ì „ì²´</label>
                        `);  // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì¶”ê°€

                        groupMembers[group].forEach(function(member, index) {
                            const memberId = 'member' + group + (index + 1); // ê³ ìœ  ID ìƒì„±
                            $('.members').append(`
                                <input type="checkbox" id="${memberId}" class="memberToggle">
                                <label for="${memberId}">${member}</label>
                            `);
                        });
                    }
                }
            } else {
                $('.fchoice').hide(); // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ë©¤ë²„ ëª©ë¡ ìˆ¨ê¹€
            }
        });

        // ë©¤ë²„ ì„ íƒ í† ê¸€ //
        // ì „ì²´ ì„ íƒ / í•´ì œ ì²˜ë¦¬
        $(document).on('change', '#memberAll', function() {
            const isChecked = $(this).prop('checked');  // ì „ì²´ ì²´í¬ë°•ìŠ¤ ìƒíƒœ
            // ëª¨ë“  ë©¤ë²„ ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ì „ì²´ ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë§ì¶° ë³€ê²½
            $('.memberToggle').prop('checked', isChecked);
        });

        // ê° ë©¤ë²„ ì„ íƒ ë°•ìŠ¤ê°€ ì„ íƒë˜ì—ˆì„ ë•Œ
        $(document).on('change', '.memberToggle', function() {
            const totalOptions = $('.memberToggle').not('#memberAll').length;  // ì „ì²´ ë©¤ë²„ ê°œìˆ˜
            const selectedOptions = $('.memberToggle:checked').not('#memberAll').length;  // ì„ íƒëœ ë©¤ë²„ ê°œìˆ˜

            // ëª¨ë“  ë©¤ë²„ê°€ ì„ íƒë˜ë©´ 'ì „ì²´ ì„ íƒ' ì²´í¬ë°•ìŠ¤ë¥¼ ì²´í¬
            if (selectedOptions === totalOptions) {
                $('#memberAll').prop('checked', true);
            } else {
                $('#memberAll').prop('checked', false);  // ì•„ë‹ˆë©´ 'ì „ì²´ ì„ íƒ' ì²´í¬ë°•ìŠ¤ë¥¼ í•´ì œ
            }
        });

    });
</script>

<body>
    <button class="fb"><a href="/photocard/write/"><i class="fas fa-pencil"></i></a></button>

    <div class="content">
        <section class="sfilter">
            <h3 class="filter-label">ğŸ” ê²€ìƒ‰í•„í„°</h3>
            <div class="fgroup">
                <h4>ê·¸ë£¹ ê²€ìƒ‰</h4>
                <div class="groupsearch">
                    <input type="text" name="searhgroup" id="searchinput" placeholder="ê·¸ë£¹ ê²€ìƒ‰ í›„ ë©¤ë²„ ì„ íƒ ê°€ëŠ¥">
                </div>
            </div>
            <div class="fchoice" style="display: none;">
                <h4>ë©¤ë²„ ì„ íƒ</h4>
                <div class="members">
                    
                </div>
            </div>

            <form method="get" action="{% url 'photocard:exchange' %}">
                <div class="fcategory">
                    <h4>ê±°ë˜ ë°©ì‹</h4>
                    <div class="dropdown">
                        <div class="dropdown-text" id="dropdownText">ì „ì²´</div>
                        <div class="dropdown-content">
                            <div class="dropdown-item" data-option="ì „ì²´">ì „ì²´</div>
                            {% for value, label in trade_choices %}
                                <div class="dropdown-item" data-option="{{ value }}">{{ label }}</div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="flocation fdiv">
                    <h4>ğŸ“ ìœ„ì¹˜ ì„¤ì •</h4>
                    <div class="clocation">ê°•ë‚¨êµ¬ (í˜„ì¬ ìœ„ì¹˜)<a href="#"><i class="fas fa-map"></i></a></div>
                    <div class="dropdown">
                        <div class="last-dropdown">
                            <div class="dropdown-text" id="dropdownText">ìì£¼ ê±°ë˜ë˜ëŠ” ì¥ì†Œ</div>
                            <div class="dropdown-content">
                                <div class="dropdown-item" data-option="ì „ì²´">ì „ì²´</div>
                                {% for value, label in place_choices %}
                                    <div class="dropdown-item" data-option="{{value}}">{{label}}</div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="searchBtn">
                    <button type="button" id="searchBtn">ê²€ìƒ‰</button>
                </div>
            </form>
        </section>

        <section class="photocardList">
            <!-- ë©¤ë²„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” ë©”ì‹œì§€ -->
            <div class="no-members">ê²€ìƒ‰ í•„í„°ì—ì„œ ë©¤ë²„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
            <div class="photoGrid">
                {% for p in photocards %}
                    <div class="cardItem">
                        <a href="/photocard/detail/{{p.pno}}/">
                            <div class="card-image">
                                <img src="/media/{{p.image}}" alt="{{p.pno}}">
                            </div>
                        </a>
                    </div>
                {% empty %}
                    <div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                {% endfor %}
            </div>
        </section>

    </div>
{% endblock content %}